---
- name: install system-wide ruby gems
  hosts: localhost
  become: true
  gather_facts: false
  tasks:
    - name: ensure each gem is installed
      community.general.gem:
        name: "{{ item }}"
        user_install: no
      loop:
        - minimal-mistakes-jekyll
        - erb

- name: clone and build jekyll websites.
  hosts: localhost
  become: false
  gather_facts: false
  vars:
    sites:
      - love
      - cookbook
      - homepage

  tasks:
    - name: clone websites repo, recursively.
      git:
        repo: git@github.com:VincentSaelzler/websites.git
        dest: ~/websites
    - name: check out the main branch of each submodule
      ansible.builtin.command:
        cmd: git checkout main
      args:
        chdir: "{{ '~/websites/' + item }}"
      loop: "{{ sites }}"
